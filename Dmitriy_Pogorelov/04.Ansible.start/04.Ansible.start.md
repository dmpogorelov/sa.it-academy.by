
## Homework - Ansible start

It was created local sandbox for HW with the following host:
+ ansiblehost - host with ansible for manage remote hosts
+ bastion - host will be used like a jump server
+ ubuntu and centos - host for tests

Full configuration you can see in Vagrantfile

```bash
==> ansible_host: Running provisioner: ansible_local...
    ansible_host: Installing Ansible...
Vagrant has automatically selected the compatibility mode '2.0'
according to the Ansible version installed (2.7.10).

Alternatively, the compatibility mode can be specified in your Vagrantfile:
https://www.vagrantup.com/docs/provisioning/ansible_common.html#compatibility_mode
    ansible_host: Running ansible-playbook...

PLAY [all] *********************************************************************

TASK [Add user ansible] ********************************************************
changed: [ansible_host]

TASK [Add sudo nopasswd] *******************************************************
changed: [ansible_host]

TASK [Allow ssh connect via password] ******************************************
changed: [ansible_host]

TASK [Restart ssh service] *****************************************************
changed: [ansible_host]

PLAY RECAP *********************************************************************
ansible_host               : ok=4    changed=4    unreachable=0    failed=0

```

/etc/ansible/hosts
```bash
[ub]
ubuntu ansible_host=192.168.10.11 ansible_python_interpreter=/usr/bin/python3.6

[cent]
centos ansible_host=192.168.10.10

[jmp]
jump-serv ansible_host=172.16.0.12 ansible_user=jump

[inside:children]
ub
cent

[all_hosts:children]
inside
jmp
```

```bash
ansible@ansiblehost:/etc/ansible/host_vars$ ansible-inventory --graph
@all:
  |--@all_hosts:
  |  |--@inside:
  |  |  |--@cent:
  |  |  |  |--centos
  |  |  |--@ub:
  |  |  |  |--ubuntu
  |  |--@jmp:
  |  |  |--jump-serv
  |--@ungrouped:

```

```bash
ansible@ansiblehost:/etc/ansible/host_vars$ sudo ansible-vault view /etc/ansible/host_vars/centos
Vault password:
ansible_user: ce_user
ansible_ssh_pass: user
ansible@ansiblehost:/etc/ansible/host_vars$ sudo ansible-vault view /etc/ansible/host_vars/ubuntu
Vault password:
ansible_user: ub_user
ansible_ssh_pass: user
```

```bash
ansible@ansiblehost:/etc/ansible/host_vars$ ansible all_hosts -m ping --ask-vault-pass
Vault password:
jump-serv | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
centos | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
ubuntu | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
```

```bash
ansible@ansiblehost:~$ ansible inside -m shell -a "hostname -f" --ask-vault-pass
Vault password:
centos | CHANGED | rc=0 >>
centos.local

ubuntu | CHANGED | rc=0 >>
ubuntu.local
```

```bash
ansible@ansiblehost:~$ ansible inside -m shell -a "/sbin/ip -4 addres|grep inet|grep -v '127.'|cut -f6 -d' '" --ask-vault-pass
Vault password:
centos | CHANGED | rc=0 >>
10.0.2.15/24
192.168.10.10/24

ubuntu | CHANGED | rc=0 >>
10.0.2.15/24
192.168.10.11/24
ansible@ansiblehost:~$ ansible inside -m shell -a "hostname -I" --ask-vault-pass
Vault password:
centos | CHANGED | rc=0 >>
10.0.2.15 192.168.10.10

ubuntu | CHANGED | rc=0 >>
10.0.2.15 192.168.10.11
```
